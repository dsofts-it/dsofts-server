# ðŸš€ Deployment Guide - DSofts Backend

## Render Deployment

### Prerequisites

- GitHub account
- Render account (free tier available at https://render.com)
- MongoDB Atlas account (free tier available)

### Step 1: Setup MongoDB Atlas

1. Go to https://www.mongodb.com/cloud/atlas
2. Create a free cluster
3. Create a database user with password
4. Whitelist all IPs (0.0.0.0/0) for Render access
5. Get your connection string:
   ```
   mongodb+srv://<username>:<password>@cluster.mongodb.net/dsofts?retryWrites=true&w=majority
   ```

### Step 2: Push to GitHub

```bash
# Already done if you followed the setup
git remote -v
# Should show: origin https://github.com/dsofts/dsofts-server.git
```

### Step 3: Deploy on Render

#### Option A: Using render.yaml (Recommended)

1. Go to https://dashboard.render.com
2. Click "New +" â†’ "Blueprint"
3. Connect your GitHub repository: `dsofts/dsofts-server`
4. Render will detect `render.yaml` automatically
5. Set environment variables:
   - `MONGO_URI`: Your MongoDB Atlas connection string
   - `CLIENT_URL`: Your frontend URL (or \* for all origins)
   - `JWT_SECRET`: Auto-generated by Render
6. Click "Apply"

#### Option B: Manual Setup

1. Go to https://dashboard.render.com
2. Click "New +" â†’ "Web Service"
3. Connect your GitHub repository: `dsofts/dsofts-server`
4. Configure:
   - **Name**: dsofts-server
   - **Environment**: Node
   - **Build Command**: `npm install`
   - **Start Command**: `npm start`
   - **Plan**: Free
5. Add Environment Variables:
   ```
   NODE_ENV=production
   PORT=5000
   MONGO_URI=mongodb+srv://username:password@cluster.mongodb.net/dsofts
   JWT_SECRET=your_super_secret_key_change_this
   JWT_EXPIRES_IN=7d
   CLIENT_URL=https://your-frontend-url.com
   ```
6. Click "Create Web Service"

### Step 4: Verify Deployment

Once deployed, your API will be available at:

```
https://dsofts-server.onrender.com
```

Test the health check:

```bash
curl https://dsofts-server.onrender.com
```

### Step 5: Update Frontend

Update your frontend to use the production API URL:

```javascript
const API_URL = 'https://dsofts-server.onrender.com/api';
```

## Environment Variables for Production

Required environment variables on Render:

| Variable       | Description        | Example                |
| -------------- | ------------------ | ---------------------- |
| NODE_ENV       | Environment        | production             |
| PORT           | Server port        | 5000                   |
| MONGO_URI      | MongoDB connection | mongodb+srv://...      |
| JWT_SECRET     | JWT secret key     | random_secure_string   |
| JWT_EXPIRES_IN | Token expiry       | 7d                     |
| CLIENT_URL     | Frontend URL       | https://yourdomain.com |

## Post-Deployment

### Seed Database (Optional)

After deployment, you can seed the database:

1. Go to Render Dashboard â†’ Your Service â†’ Shell
2. Run:
   ```bash
   npm run seed
   ```

### Create Admin User

1. First, signup via API
2. Then in Render Shell:
   ```bash
   node makeAdmin.js rohan@dsofts.in
   ```

## Monitoring

- **Logs**: Available in Render Dashboard â†’ Logs
- **Metrics**: CPU, Memory usage in Dashboard
- **Health Check**: Automatic via Render

## Custom Domain (Optional)

1. Go to Render Dashboard â†’ Your Service â†’ Settings
2. Add custom domain
3. Update DNS records as instructed
4. SSL certificate is automatic

## Troubleshooting

### Deployment Failed

- Check build logs in Render Dashboard
- Verify all environment variables are set
- Check MongoDB Atlas IP whitelist

### Database Connection Error

- Verify MONGO_URI is correct
- Check MongoDB Atlas user credentials
- Ensure IP whitelist includes 0.0.0.0/0

### CORS Errors

- Update CLIENT_URL environment variable
- Or set to '\*' for development

## Free Tier Limitations

Render Free Tier:

- âœ… 750 hours/month
- âœ… Auto-sleep after 15 min inactivity
- âœ… First request after sleep takes ~30 seconds
- âœ… Perfect for development/testing

For production, consider upgrading to paid tier for:

- No auto-sleep
- Better performance
- More resources

## Continuous Deployment

Render automatically deploys when you push to GitHub:

```bash
git add .
git commit -m "Update backend"
git push origin main
```

Render will:

1. Detect the push
2. Run build command
3. Deploy new version
4. Zero-downtime deployment

## Alternative Deployment Options

### Heroku

```bash
heroku create dsofts-server
heroku config:set MONGO_URI=your_uri
git push heroku main
```

### Railway

1. Connect GitHub repo
2. Set environment variables
3. Deploy

### DigitalOcean App Platform

1. Connect GitHub repo
2. Configure build settings
3. Deploy

---

**Your backend is now production-ready! ðŸš€**
